function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n=globalThis,i={},s={},o=n.parcelRequire0d3b;null==o&&((o=function(t){if(t in i)return i[t].exports;if(t in s){var e=s[t];delete s[t];var n={id:t,exports:{}};return i[t]=n,e.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){s[t]=e},n.parcelRequire0d3b=o);var a=o.register;a("4D3px",function(e,n){t(e.exports,"Config",()=>i);let i=Object.freeze({canvasElementId:"app-canvas",pointsCountInputId:"app-points-count-input",fpsOutputBlockId:"app-fps-output",pointsSizeInput:"app-point-size-input"})}),a("fypJ4",function(e,n){t(e.exports,"PointsAnimation",()=>a);var i=o("4D3px"),s=o("3V8rW");class a{constructor(t,e,n,i,o,a,r){this.physics=t,this.renderer=e,this.renderingtType=n,this.canvasElement=i,this.pointsCountInput=o,this.fpsOutput=a,this.pointsSizeChangeInput=r,this.pointsCount=0,this.canvasSize={width:0,height:0},this.handlePointSizeChange=()=>{this.renderer.setPointSize(Number(this.pointsSizeChangeInput.value))},this.handleInput=()=>{let t=Number(this.pointsCountInput.value);t>=1&&(this.pointsCount=t)},this.handleClick=t=>{let e=this.renderingtType===s.CanvasRenderingType.Usual?this.getClickCoordinatesForUsualCanvas(t):this.getClickCoordinatesForWebGLCanvas(t);this.physics.run(e)},this.validateHTML()}startListening(){let t=0,e=0,n=(i=0)=>{window.requestAnimationFrame(n),this.physics.tick(this.pointsCount),this.renderer.render(this.physics.data,this.pointsCount,this.canvasSize),++e,i>t+2e3&&(this.fpsOutput.innerText=(1e3*e/(i-t)).toFixed(2),t=i,e=0)};n()}setupHandlers(){this.canvasElement.width=this.canvasElement.clientWidth,this.canvasElement.height=this.canvasElement.clientHeight,this.canvasSize={width:this.canvasElement.clientWidth,height:this.canvasElement.clientHeight},this.pointsCountInput.addEventListener("input",this.handleInput),this.handleInput(),this.canvasElement.addEventListener("click",this.handleClick),this.pointsSizeChangeInput.addEventListener("input",this.handlePointSizeChange),this.handlePointSizeChange()}getClickCoordinatesForUsualCanvas(t){let e=this.canvasElement.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}getClickCoordinatesForWebGLCanvas(t){let e=this.canvasElement.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,s=n-this.canvasElement.clientWidth/2,o=i-this.canvasElement.clientHeight/2;return console.log("Click in pixels from center:",s,o),{x:s,y:o}}validateHTML(){if(!this.canvasElement||!(this.canvasElement instanceof HTMLCanvasElement))throw console.error(`[App]: Canvas element not found. Add <canvas/> with #${i.Config.canvasElementId}`),Error();if(!this.pointsCountInput||!(this.pointsCountInput instanceof HTMLInputElement))throw console.error(`[App]: Input element not found. Add <input/> with #${i.Config.pointsCountInputId}`),Error();if(!this.fpsOutput||!(this.fpsOutput instanceof HTMLElement))throw console.error(`[App]: FPS output element not found. Add element with #${i.Config.pointsCountInputId}`),Error()}}}),a("3V8rW",function(e,n){t(e.exports,"CanvasRenderingType",()=>s);var i,s=((i={}).Usual="Usual",i.WebGL="WebGL",i)}),a("aP3eO",function(e,n){t(e.exports,"JavaScriptPhysics",()=>s);var i=o("mDWTX");class s{static{this.Acceleration=.01}static{this.PI_2=2*Math.PI}constructor(){this.points=new Float32Array(0)}get data(){return this.points}tick(t){this.points=(0,i.resizeF32Array)(this.points,4*t);for(let t=0;t<this.points.length;t+=4)this.points[t+0]+=this.data[t+2],this.points[t+1]+=this.data[t+3],this.points[t+3]+=s.Acceleration}run({x:t,y:e}){for(let n=0;n<this.points.length;n+=4){this.points[n+0]=t,this.points[n+1]=e;let i=29*Math.sqrt(Math.random()),o=Math.random()*s.PI_2;this.points[n+2]=Math.cos(o)*i,this.points[n+3]=Math.sin(o)*i}}}}),a("mDWTX",function(e,n){t(e.exports,"resizeF32Array",()=>i);let i=(t,e)=>{let n=new Float32Array(e);return n.set(t.subarray(0,Math.min(t.length,e))),n}});var r=o("4D3px"),h=o("fypJ4"),l=o("aP3eO"),c=o("3V8rW"),p={};p="precision lowp float;\n#define GLSLIFY 1\n // точность\n\nattribute vec2 coord;\nattribute vec2 scale;\nuniform float pointSize; // for controling point size from JS\n\nvoid main() {\n    gl_Position = vec4(\n        coord.x * scale.x,\n        coord.y * scale.y,\n        0,\n        1\n    );\n\n    gl_PointSize = pointSize;\n}";var u={};u="precision lowp float;\n#define GLSLIFY 1\n\nvoid main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n}";class d{constructor(t){this.canvasRef=t,this.pointSizeLocation=null,this.firstTimeResizeCounter=0,this.pointSize=2;let e=this.canvasRef.getContext("webgl2",{alpha:!1,antialias:!1})||this.canvasRef.getContext("webgl",{alpha:!1,antialias:!1});if(!e)throw console.error("[App]: Can not get context from canvas ",t),Error();this.context=e,this.program=this.context.createProgram(),this.init()}init(){let t=this.context;t.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),t.clearColor(0,0,0,1),this.loadCompileAttachShader(e(p),t.VERTEX_SHADER),this.loadCompileAttachShader(e(u),t.FRAGMENT_SHADER),t.linkProgram(this.program),t.useProgram(this.program),this.pointSizeLocation=t.getUniformLocation(this.program,"pointSize");let n=t.getAttribLocation(this.program,"coord");t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,16,0);let i=this.canvasRef.clientWidth,s=this.canvasRef.clientHeight;t.viewport(0,0,i,s)}loadCompileAttachShader(t,e){let n=this.context,i=n.createShader(e);if(!i)throw console.error("[App]: Can not create shader "),Error();n.shaderSource(i,t),n.compileShader(i),console.log(n.getShaderInfoLog(i)),n.attachShader(this.program,i)}setPointSize(t){this.pointSize=t,this.pointSizeLocation&&this.context.uniform1f(this.pointSizeLocation,t)}render(t,e){let n=this.context,i=n.getAttribLocation(this.program,"scale");console.log(i),n.disableVertexAttribArray(i),n.vertexAttrib2f(i,2/this.canvasRef.width,-2/this.canvasRef.height),n.bufferData(n.ARRAY_BUFFER,t.subarray(0,4*e),n.DYNAMIC_DRAW),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.POINTS,0,e)}}!function(){let t=document.getElementById(r.Config.pointsCountInputId),e=document.getElementById(r.Config.fpsOutputBlockId),n=document.getElementById(r.Config.pointsSizeInput),i=document.getElementById(r.Config.canvasElementId),s=new(0,l.JavaScriptPhysics),o=new d(i),a=new(0,h.PointsAnimation)(s,o,c.CanvasRenderingType.WebGL,i,t,e,n);a.setupHandlers(),a.startListening()}();
//# sourceMappingURL=webgl.e3bde212.js.map
